#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” åŸ·è¡Œ pre-commit æª¢æŸ¥..."

# åŸ·è¡Œ lint-staged
npx lint-staged

# æª¢æŸ¥æ˜¯å¦æœ‰æœªè¿½è¹¤çš„å¤§å‹æª”æ¡ˆ
echo "ğŸ“ æª¢æŸ¥æª”æ¡ˆå¤§å°..."
if [ -n "$(find . -name '*.json' -size +1M -not -path './node_modules/*' -not -path './.git/*')" ]; then
  echo "âŒ ç™¼ç¾å¤§å‹ JSON æª”æ¡ˆï¼Œè«‹ç¢ºèªæ˜¯å¦éœ€è¦æäº¤ï¼š"
  find . -name '*.json' -size +1M -not -path './node_modules/*' -not -path './.git/*'
  exit 1
fi

# æª¢æŸ¥ç’°å¢ƒè®Šæ•¸æª”æ¡ˆ
echo "ğŸ” æª¢æŸ¥ç’°å¢ƒè®Šæ•¸æª”æ¡ˆ..."
if git diff --cached --name-only | grep -E '\.(env|key|pem)$' | grep -v '\.example'; then
  echo "âŒ å˜—è©¦æäº¤æ•æ„Ÿæª”æ¡ˆï¼è«‹æª¢æŸ¥ä»¥ä¸‹æª”æ¡ˆï¼š"
  git diff --cached --name-only | grep -E '\.(env|key|pem)$' | grep -v '\.example'
  echo "å»ºè­°ï¼š"
  echo "  1. å°‡æ•æ„Ÿæª”æ¡ˆåŠ å…¥ .gitignore"
  echo "  2. ä½¿ç”¨ git rm --cached <file> ç§»é™¤è¿½è¹¤"
  echo "  3. åªæäº¤ .example ç¯„æœ¬æª”æ¡ˆ"
  exit 1
fi

echo "âœ… Pre-commit æª¢æŸ¥é€šéï¼" 